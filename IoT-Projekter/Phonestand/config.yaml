esphome:
  name: hybridpresencenode
  friendly_name: Hybrid Presence Node

esp32:
  board: esp32dev
  framework:
    type: esp-idf

wifi:
  ssid: !secret wifi_ssid
  password: !secret wifi_password

# Enable API for HA integration
api:
  encryption:
    key: !secret esphome_api_encryption_key
logger:
  level: INFO
ota:
  - platform: esphome
    password: !secret esphome_ota_password

# MQTT (optional if you want direct MQTT publishing in addition to HA API)
#mqtt:
#  broker: !secret mqtt_broker
#  username: !secret mqtt_user
#  password: !secret mqtt_pass

# --- Bluetooth Proxy ---
#bluetooth_proxy:
esp32_ble_tracker:

# --- PN532 NFC Reader ---
i2c:
  sda: 21
  scl: 22
  scan: true
  frequency: 50kHz

pn532_i2c:
  update_interval: 1s
  on_tag:
    then:
      - lambda: |-
          std::string uid_str;
          for (auto b : tag.get_uid()) {
            char hex[4];
            sprintf(hex, "%02X-", b);
            uid_str += hex;
          }
          if (!uid_str.empty()) {
            uid_str.pop_back();  // remove trailing dash
          }
          ESP_LOGI("nfc", "ðŸŽ¯ Tag UID: %s", uid_str.c_str());

binary_sensor:
  - platform: pn532
    uid: "04-92-C4-CB-4C-59-80"   # iPhone NFC tag UID
    name: "Thomas iPhone NFC"
  - platform: pn532
    uid: "04-52-EB-CB-4C-59-80"      # Android NFC tag UID
    name: "Thomas Android NFC"

  - platform: ble_presence
    irk: "36d882e492530f80d17db3d6fb43b062"
    name: "Android BLE Presence (present)"
  - platform: ble_presence
    irk: "40e9be44eeb0c24aa3d64bb9367607cf"
    name: "iPhone BLE Presence (present)"

sensor:
  - platform: ble_rssi
    irk: "36d882e492530f80d17db3d6fb43b062"
    name: "Android BLE RSSI"
  - platform: ble_rssi
    irk: "40e9be44eeb0c24aa3d64bb9367607cf"
    name: "iPhone BLE RSSI"
